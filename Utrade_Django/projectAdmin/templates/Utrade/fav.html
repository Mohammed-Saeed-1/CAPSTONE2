{% extends 'after_base.html' %}
{% block title %}Fav{% endblock %}

{% load static %}

{% block content %}
<style>
    .buttons {
        background-color: #2880df;
        color: white;
        padding-top: 10px;
        padding-bottom: 0;
    }
    .buttons h4{
        font-size: x-large;
    }
    .buttons:hover {
        background-color: #1b63af;
        color: white;
    }

</style>
{% endblock content %}


{% block content2 %}
<script>
    
</script>
<main id="main" class="main">

    <div class="pagetitle">
        <h1>Favorite</h1>
        <nav>
        <ol class="breadcrumb">
            <li class="breadcrumb-item active"><a>Favorite</a></li>
        </ol>
        </nav>
    </div><!-- End Page Title -->
    </div>
    
        <div id="favorite" style="display: block;">
            <div id="output_favorite"></div>
        </div>
    
    <!-- gg -->
        <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    
        <script type="text/javascript">
    
            var output_favorite = document.getElementById('output_favorite');
            {% comment %} const favoriteStocks = JSON.parse(localStorage.getItem('favoriteStocks')) || []; {% endcomment %}
            
            $.ajax({
                type: 'GET',
                url: '/get_favorite_stocks/',
                success: function (response) {
                    favoriteStocks = response.favorite_stocks;
                    
                    favoriteStocks.forEach(symbol => {
                        symbolTarget = symbol+"T";
                        output_favorite.innerHTML += `
                            <div class="card" style="background-color: white;">
                                <button class="btn collapsible buttons"><h4>${symbol}</h4></button>
                                <div class="card collapsible-content" style="margin-top: 20px; background-color: rgb(217, 238, 254); margin: 10px;">
                                    <div class="card-body">
                                        <h5 class="card-title">Chart <span>/Now</span></h5>
            
                                        <!--<button style="color:white; margin: 15px 15px 15px 0px;" onclick="toggleNews('${symbol}')" class="btn bg-primary">${symbol} News</button>-->
            
                                        <div class="tradingview-widget-container" style="height: 100%; width: 100%; margin-bottom: 20px;">
                                            <div id="${symbolTarget}" style="width: 100%; height: 550px;">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
            
                        new TradingView.widget({
                            "autosize": true,
                            "symbol": `NASDAQ:${symbol}`,
                            "interval": "D",
                            "timezone": "Asia/Kuwait",
                            "theme": "light",
                            "style": "1",
                            "locale": "en",
                            "enable_publishing": false,
                            "allow_symbol_change": true,
                            "hide_top_toolbar": false,
                            "details": false,
                            "hotlist": false,
                            "calendar": false,
                            "container_id": `${symbolTarget}`
                        });
                    });
            
                    // Get all elements with the "collapsible" class
                    const collapsibleButtons = document.querySelectorAll(".collapsible");
            
                    // Add click event listeners to each button
                    collapsibleButtons.forEach(button => {
                        button.addEventListener("click", function () {
                            // Toggle the visibility of the next sibling with the "collapsible-content" class
                            const content = this.nextElementSibling;
                            content.style.display = content.style.display === "block" ? "none" : "block";
                        });
                    });
            
                    // Add click event listeners to each button
                    collapsibleButtons.forEach(button => {
                        button.addEventListener("click", function () {
                            // Toggle the visibility of the next sibling with the "collapsible-content" class
                            const content = this.nextElementSibling;
                            if (content.style.maxHeight) {
                                content.style.maxHeight = null;
                            } else {
                                content.style.maxHeight = content.scrollHeight + "px";
                            }
                        });
                    });
                },
                error: function (error) {
                    console.error(error);
                }
            });
    
            // function toggleNews(symbol){
            //     localStorage.setItem("SymbolNews", symbol);
            //     window.location.href = "{% url 'Utrade:news' %}";
            // }
    
        </script>
    
    
    <script>
            document.getElementById('favorite_btn').addEventListener('click', ()=>{
                show_by_id('favorite');
                hidden_by_id('popular')
            });
    
            function show_by_id(elementId){
                var content = document.getElementById(elementId);
                if (content.style.display === 'none') {
                    content.style.display = 'block';
                }
            }
            function hidden_by_id(elementId){
                var content = document.getElementById(elementId);
                if (content.style.display === 'block') {
                    content.style.display = 'none';
                }
            }
      </script>
</main><!-- End #main -->


{% endblock content2 %}